{% extends 'USER/base_user.html' %}
{% block title %}Report Injured Animal{% endblock %}

{% block body %}
<div class="container animate-fade" style="max-width: 900px; margin-top: 60px;">
    <div style="text-align: center; margin-bottom: 50px;">
        <h1
            style="font-size: clamp(32px, 5vw, 42px); font-weight: 800; background: linear-gradient(135deg, #fff 0%, #e74c3c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 16px;">
            Emergency Report
        </h1>
        <p style="color: var(--text-secondary); font-size: 18px;">Provide precise details to dispatch our rescue squads
            immediately.</p>
    </div>

    <form action="" method="post" enctype="multipart/form-data" class="card" style="padding: 40px;">
        {% csrf_token %}

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <div>
                <label
                    style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 14px;">Animal
                    Category</label>
                <select name="animal_type" required
                    style="width: 100%; padding: 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 12px; color: #fff; font-family: inherit;">
                    <option value="Dog" style="background: var(--surface);">Canine (Dog)</option>
                    <option value="Cat" style="background: var(--surface);">Feline (Cat)</option>
                    <option value="Bird" style="background: var(--surface);">Avian (Bird)</option>
                    <option value="Cow" style="background: var(--surface);">Bovine (Cow)</option>
                    <option value="Other" style="background: var(--surface);">Other Species</option>
                </select>
            </div>
            <div>
                <label
                    style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 14px;">Visual
                    Evidence (Photo)</label>
                <input type="file" name="image" required
                    style="width: 100%; padding: 10px; background: rgba(255,255,255,0.03); border: 1px dashed var(--glass-border); border-radius: 12px; color: var(--text-secondary); font-size: 14px;">
            </div>
        </div>

        <div style="margin-bottom: 30px;">
            <label
                style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 14px;">Condition
                Description</label>
            <textarea name="description" required minlength="10"
                placeholder="Describe the injuries or behavior (e.g., 'Limping heavily, possible fracture, near the park fountain')"
                style="width: 100%; padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 14px; color: #fff; height: 120px; resize: none; line-height: 1.6;"></textarea>
        </div>

        <div style="margin-bottom: 30px;">
            <label
                style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 14px;">Exact
                Location / Landmarks</label>
            <input type="text" name="location" required placeholder="Street address or visible landmarks"
                style="width: 100%; padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 14px; color: #fff;">
        </div>

        <div
            style="background: rgba(46, 204, 113, 0.03); border: 1px solid rgba(46, 204, 113, 0.1); border-radius: 18px; padding: 24px; margin-bottom: 40px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h4 style="font-size: 16px; font-weight: 700; color: var(--accent);">Precise Coordinates</h4>
                <button type="button" onclick="getLocation()" class="btn btn-outline"
                    style="padding: 8px 16px; font-size: 13px;">
                    <i class="fas fa-crosshairs"></i> Get Current Position
                </button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <input type="text" name="lat" id="lat" placeholder="Latitude" readonly
                    style="padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 10px; color: #fff; font-family: monospace;">
                <input type="text" name="lon" id="lon" placeholder="Longitude" readonly
                    style="padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 10px; color: #fff; font-family: monospace;">
            </div>
        </div>

        <button type="submit" class="btn btn-primary"
            style="width: 100%; padding: 18px; font-size: 18px; letter-spacing: 0.5px;">
            <i class="fas fa-paper-plane"></i> Dispatch Rescue Team
        </button>
    </form>
</div>

<script>
    function getLocation() {
        if (navigator.geolocation) {
            Swal.fire({
                title: 'Detecting...',
                text: 'Calculating your precise coordinates.',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading(); }
            });
            navigator.geolocation.getCurrentPosition(function (position) {
                document.getElementById('lat').value = position.coords.latitude;
                document.getElementById('lon').value = position.coords.longitude;
                Swal.fire({
                    icon: 'success',
                    title: 'Located',
                    text: 'Co-ordinates updated successfully.',
                    timer: 1500,
                    showConfirmButton: false,
                    background: '#131520',
                    color: '#fff'
                });
            }, function () {
                Swal.fire({
                    icon: 'error',
                    title: 'Failed',
                    text: 'Could not access location. Please enter coordinates manually.',
                    background: '#131520',
                    color: '#fff'
                });
            });
        } else {
            Swal.fire('Error', 'Geolocation is not supported by this browser.', 'error');
        }
    }
</script>
{% endblock %}
{% endblock %}