{% extends 'USER/base_user.html' %}
{% block title %}Adopt a Pet{% endblock %}
{% block body %}
<div class="container animate-fade" style="margin-top:60px;">
    <div
        style="display:flex;justify-content:space-between;align-items:center;margin-bottom:50px;flex-wrap:wrap;gap:20px;">
        <div>
            <h2 style="font-size:clamp(28px,4vw,36px);font-weight:800;margin-bottom:8px;">Waiting for You</h2>
            <p style="color:var(--text-secondary);">Find a forever friend from our list of approved, healthy residents.
            </p>
        </div>
        <a href="/user_home/" class="btn btn-outline" style="padding:12px 24px;"><i class="fas fa-arrow-left"></i> Home
            Dashboard</a>
    </div>

    {% if messages %}
    <div style="margin-bottom:30px;">
        {% for message in messages %}
        <div style="padding:16px 24px;border-radius:16px;margin-bottom:10px;font-size:14px;font-weight:600;
{% if message.tags == 'success' %}background:rgba(46,204,113,0.1);color:#2ecc71;border:1px solid rgba(46,204,113,0.2);
{% elif message.tags == 'warning' %}background:rgba(241,196,15,0.1);color:#f1c40f;border:1px solid rgba(241,196,15,0.2);
{% elif message.tags == 'info' %}background:rgba(52,152,219,0.1);color:#3498db;border:1px solid rgba(52,152,219,0.2);
{% else %}background:rgba(231,76,60,0.1);color:#e74c3c;border:1px solid rgba(231,76,60,0.2);
{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:30px;">
        {% for animal in animals %}
        <div class="card" style="padding:0;overflow:hidden;display:flex;flex-direction:column;">
            <div
                style="height:240px;position:relative;background:rgba(0,0,0,0.3);border-bottom:1px solid var(--glass-border);">
                {% if animal.photo %}
                <img src="
{{ animal.photo.url }}
" style="width:100%;height:100%;object-fit:cover;">
                {% else %}
                <div
                    style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);opacity:0.15;">
                    <i class="fas fa-paw fa-5x"></i>
                </div>
                {% endif %}
                <div style="position:absolute;top:15px;right:15px;">
                    {% if animal.id in user_requests %}
                    {% with req=user_requests|dictsort:"id" %}
                    {% endwith %}
                    <span style="padding:6px 14px;border-radius:100px;font-size:11px;font-weight:800;backdrop-filter:blur(5px);
{% if user_requests.items|length >= 0 %}
{% for aid, req in user_requests.items %}
{% if aid == animal.id %}
{% if req.status == 'Pending' %}background:rgba(241,196,15,0.15);color:#f1c40f;border:1px solid #f1c40f;">⏳ PENDING
                        {% elif req.status == 'Approved' %}background:rgba(46,204,113,0.15);color:#2ecc71;border:1px
                        solid #2ecc71;">✅ APPROVED
                        {% elif req.status == 'Rejected' %}background:rgba(231,76,60,0.15);color:#e74c3c;border:1px
                        solid #e74c3c;">❌ REJECTED
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                    </span>
                    {% else %}
                    <span
                        style="background:rgba(46,204,113,0.15);color:var(--accent);padding:6px 14px;border-radius:100px;font-size:11px;font-weight:800;border:1px solid var(--accent);backdrop-filter:blur(5px);">MEDICAL
                        CLEARANCE: OK</span>
                    {% endif %}
                </div>
            </div>
            <div style="padding:30px;flex:1;display:flex;flex-direction:column;">
                <h3 style="font-size:22px;font-weight:700;margin-bottom:12px;">
                    {{ animal.name|default:animal.species }}
                </h3>
                <div style="margin-bottom:15px;display:flex;gap:10px;">
                    <span style="font-size:11px;font-weight:800;color:var(--text-secondary);text-transform:uppercase;">
                        {{ animal.species }}
                    </span>
                    {% if animal.breed %}
                    <span style="font-size:11px;font-weight:800;color:var(--text-secondary);text-transform:uppercase;">•
                        {{ animal.breed }}
                    </span>
                    {% endif %}
                </div>
                <p style="color:var(--text-secondary);font-size:15px;margin-bottom:24px;line-height:1.7;">
                    Currently sheltered at <strong style="color:#fff;">
                        {{ animal.care_center.name }}
                    </strong>. Review full clinical history before proceeding.</p>
                <div style="margin-top:auto;display:flex;gap:12px;">
                    <a href="/user_animal_detail/?id=
{{ animal.id }}
" class="btn btn-outline" style="flex:1;padding:14px;font-size:13px;">View File</a>
                    {% if animal.id in user_requests %}
                    {% for aid, req in user_requests.items %}
                    {% if aid == animal.id and req.status == 'Pending' %}
                    <a href="/user_cancel_adoption/?id=
{{ req.id }}
" class="btn btn-outline" style="flex:1;padding:14px;font-size:13px;border-color:#e74c3c;color:#e74c3c;"><i
                            class="fas fa-times"></i> Cancel Request</a>
                    {% elif aid == animal.id and req.status == 'Approved' %}
                    <span class="btn btn-primary"
                        style="flex:1;padding:14px;font-size:13px;background:#2ecc71;border:none;cursor:default;"><i
                            class="fas fa-check-circle"></i> Approved</span>
                    {% elif aid == animal.id and req.status == 'Rejected' %}
                    <span class="btn btn-outline"
                        style="flex:1;padding:14px;font-size:13px;border-color:#e74c3c;color:#e74c3c;cursor:default;opacity:0.6;"><i
                            class="fas fa-ban"></i> Rejected</span>
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    <a href="/user_submit_adoption/?id=
{{ animal.id }}
" class="btn btn-primary" style="flex:1;padding:14px;font-size:13px;"><i class="fas fa-heart"></i> Adopt</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div
            style="grid-column:1/-1;text-align:center;padding:120px 20px;background:var(--surface);border-radius:32px;border:2px dashed var(--border);">
            <div
                style="width:100px;height:100px;background:rgba(255,255,255,0.03);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-size:42px;margin:0 auto 30px;">
                <i class="fas fa-house-user"></i>
            </div>
            <h3 style="font-size:26px;font-weight:700;margin-bottom:12px;">Quiet in the Sanctuary</h3>
            <p style="color:var(--text-secondary);font-size:17px;max-width:500px;margin:0 auto;">No residents currently
                pending adoption.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}