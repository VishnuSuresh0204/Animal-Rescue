{% extends 'CARE/base_care.html' %}
{% block title %}Daily Care Log{% endblock %}

{% block body %}
<div class="container animate-fade" style="margin-top: 60px;">
    <div
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 50px; flex-wrap: wrap; gap: 20px;">
        <div>
            <h2 style="font-size: clamp(28px, 4vw, 36px); font-weight: 800; margin-bottom: 8px;">Care & Feeding Log</h2>
            <p style="color: var(--text-secondary);">Execute and document daily protocols for this resident.</p>
        </div>
        <a href="/care_view_pets/" class="btn btn-outline" style="padding: 12px 24px;">
            <i class="fas fa-arrow-left"></i> Resident List
        </a>
    </div>

    <div style="display: grid; grid-template-columns: minmax(350px, 400px) 1fr; gap: 40px; align-items: start;">
        <!-- Control Panel & Requirements -->
        <div style="display: flex; flex-direction: column; gap: 30px;">
            <!-- New Log Form -->
            <div class="card" style="padding: 35px; border-radius: 28px;">
                <h3
                    style="font-size: 20px; font-weight: 700; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-pen-nib" style="color: var(--accent);"></i> New Entry
                </h3>
                <form method="POST">
                    {% csrf_token %}
                    <div style="margin-bottom: 24px;">
                        <label
                            style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 13px; letter-spacing: 0.5px;">ACTIVITY
                            TYPE</label>
                        <select name="log_type" required
                            style="width: 100%; padding: 16px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 14px; color: #fff; font-size: 15px; appearance: none; cursor: pointer;">
                            <option value="Food">Nutritional Intake (Feeding)</option>
                            <option value="Medicine">Therapeutic Administration (Medication)</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 30px;">
                        <label
                            style="display: block; margin-bottom: 10px; color: var(--text-secondary); font-weight: 600; font-size: 13px; letter-spacing: 0.5px;">EXECUTION
                            DETAILS</label>
                        <textarea name="description" required minlength="5" rows="4"
                            placeholder="e.g. Administered prescribed 5ml dosage at 09:00 AM..."
                            style="width: 100%; padding: 18px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 16px; color: #fff; font-size: 15px; resize: none; transition: 0.3s;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary"
                        style="width: 100%; padding: 18px; border-radius: 16px; font-weight: 700; box-shadow: 0 10px 25px rgba(46, 204, 113, 0.2);">
                        Commit Log Entry
                    </button>
                </form>
            </div>

            <!-- Clinical Chronology (Medical Status) -->
            <div style="margin-top: 20px;">
                <div
                    style="font-size: 14px; font-weight: 700; color: #fff; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-history" style="color: var(--accent); width: 16px;"></i> Clinical Chronology
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    {% for record in animal.medical_records.all %}
                    <div
                        style="background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 11px; font-weight: 800; color: var(--accent);">{{
                                record.date|date:"Y-m-d" }}</span>
                            <span style="font-size: 11px; font-weight: 800; color: #fff;">{{ record.condition_after
                                }}</span>
                        </div>
                        <div style="font-size: 12px; color: #fff; margin-bottom: 4px; font-weight: 600;">{{
                            record.diagnosis }}</div>
                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.4;">{{
                            record.treatment }}</div>
                    </div>
                    {% empty %}
                    <p style="font-size: 13px; color: var(--text-secondary); font-style: italic;">No clinical entries
                        recorded.</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Log History Timeline -->
        <div class="card" style="padding: 40px; border-radius: 32px; flex: 1;">
            <div
                style="display: flex; align-items: center; gap: 15px; margin-bottom: 35px; border-bottom: 1px solid var(--border); padding-bottom: 25px;">
                <div
                    style="width: 48px; height: 48px; background: rgba(255,255,255,0.03); color: var(--text-secondary); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                    <i class="fas fa-stream"></i>
                </div>
                <h3 style="font-size: 22px; font-weight: 700;">Operational History</h3>
            </div>

            <div style="display: flex; flex-direction: column; gap: 20px; position: relative; padding-left: 30px;">
                <!-- Vertical timeline line -->
                <div
                    style="position: absolute; left: 7px; top: 10px; bottom: 10px; width: 1px; background: var(--border);">
                </div>

                {% for log in logs %}
                <div style="position: relative;">
                    <!-- Timeline point -->
                    <div
                        style="position: absolute; left: -26px; top: 18px; width: 7px; height: 7px; border-radius: 50%; background: {% if log.log_type == 'Food' %}#f1c40f{% else %}#3498db{% endif %}; box-shadow: 0 0 10px {% if log.log_type == 'Food' %}#f1c40f{% else %}#3498db{% endif %};">
                    </div>

                    <div style="background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 20px 25px; border-radius: 20px; transition: 0.3s;"
                        onmouseover="this.style.background='rgba(255,255,255,0.03)'"
                        onmouseout="this.style.background='rgba(255,255,255,0.02)'">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <span
                                style="font-weight: 800; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: {% if log.log_type == 'Food' %}#f1c40f{% else %}#3498db{% endif %};">
                                <i class="fas {% if log.log_type == 'Food' %}fa-utensils{% else %}fa-prescription-bottle-alt{% endif %}"
                                    style="margin-right: 6px;"></i>
                                {{ log.log_type }}
                            </span>
                            <span style="font-size: 13px; color: var(--text-secondary); font-family: monospace;">{{
                                log.given_at|time:"H:i" }}</span>
                        </div>
                        <p style="margin: 0; font-size: 15px; color: #fff; line-height: 1.6;">{{ log.description }}</p>
                    </div>
                </div>
                {% empty %}
                <div style="text-align: center; padding: 80px 20px; opacity: 0.3;">
                    <i class="fas fa-calendar-day fa-3x" style="margin-bottom: 20px;"></i>
                    <p style="font-size: 16px;">No activity recorded in the current cycle.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    textarea:focus,
    select:focus {
        border-color: var(--accent) !important;
        outline: none;
        box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.1);
    }
</style>
{% endblock %}